{% extends 'horarios/base.html' %}
{% load static %}

{% block extra_css %}
<style>
/* Variables para colores y transiciones */
:root {
    --color-success: #28a745;
    --color-success-hover: #218838;
    --color-success-light: rgba(40, 167, 69, 0.05);
    --color-success-lighter: rgba(40, 167, 69, 0.02);
    --color-danger: #dc3545;
    --color-danger-hover: #c82333;
    --color-warning: #ffc107;
    --color-gray: #6c757d;
    --color-gray-light: #dee2e6;
    --color-gray-lighter: #f8f9fa;
    --border-radius-sm: 8px;
    --border-radius: 15px;
    --border-radius-lg: 20px;
    --transition-default: all 0.3s ease;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
    --shadow: 0 5px 15px rgba(0,0,0,0.08);
    --shadow-lg: 0 8px 25px rgba(0,0,0,0.12);
}

/* Reset y estilos base */
button:focus, a:focus, input:focus, select:focus {
    outline: none;
}

button:focus-visible, a:focus-visible, input:focus-visible, select:focus-visible {
    outline: 3px solid rgba(40, 167, 69, 0.4);
    outline-offset: 2px;
}

.transition {
    transition: var(--transition-default);
}

/* Estilos para la card principal */
.card {
    border: none;
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: var(--transition-default);
}

.card:hover {
    box-shadow: var(--shadow-lg);
}

.card-header {
    border-bottom: 0;
    background-color: var(--color-success);
}

.card-body {
    padding: 2rem;
    background-color: #fff;
}

/* Estilos mejorados para los botones principales */
.btn {
    padding: 0.6rem 1.25rem;
    border-radius: 50px;
    font-weight: 500;
    letter-spacing: 0.3px;
    transition: var(--transition-default);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.btn:active {
    transform: translateY(0);
}

.btn-success {
    background-color: var(--color-success);
    border-color: var(--color-success);
}

.btn-success, .btn-success i {
    color: black !important;
    font-weight: 500;
}

.btn-success:hover, .btn-success:focus {
    background-color: var(--color-success-hover);
    border-color: var(--color-success-hover);
    color: black !important;
}

.btn-light {
    background-color: white;
    border-color: #dee2e6;
}

.btn-light:hover {
    background-color: #f8f9fa;
    border-color: #dee2e6;
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
}

.btn-dark {
    background-color: #212529;
    border-color: #212529;
    color: white;
}

.btn-dark:hover {
    background-color: #343a40;
    border-color: #343a40;
    color: white;
}

.btn-outline-danger {
    color: var(--color-danger);
    border-color: var(--color-danger);
}

.btn-outline-danger:hover {
    background-color: var(--color-danger);
    border-color: var(--color-danger);
    color: white;
}

.btn-outline-success {
    color: var(--color-success);
    border-color: var(--color-success);
}

.btn-outline-success:hover {
    background-color: var(--color-success);
    border-color: var(--color-success);
    color: white;
}

/* Barra de búsqueda mejorada */
.search-wrapper {
    position: relative;
    width: 100%;
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
}

.custom-search-input {
    width: 100%;
    padding: 14px 55px 14px 25px;
    border: 2px solid var(--color-gray-light);
    border-radius: 50px;
    font-size: 0.95rem;
    transition: var(--transition-default);
    background: white;
    outline: none;
}

.custom-search-input:focus {
    border-color: var(--color-success);
    box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.15);
}

.search-btn {
    position: absolute;
    right: 12px; /* Ajustado de 8px a 12px para moverlo más a la izquierda */
    top: 50%;
    transform: translateY(-50%);
    background: var(--color-success);
    border: none;
    width: 38px;
    height: 38px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    cursor: pointer;
    transition: var(--transition-default);
}

.search-btn:hover {
    background: var(--color-success-hover);
    transform: translateY(-50%) scale(1.05);
}

.clear-btn {
    position: absolute;
    right: 55px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--color-gray);
    cursor: pointer;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition-default);
    z-index: 2;
}

.clear-btn:hover {
    color: var(--color-danger);
    transform: translateY(-50%) scale(1.2);
}

/* Estilos para la tabla */
.table-container {
    position: relative;
    background-color: white;
    border-radius: var(--border-radius);
    border: 1px solid var(--color-gray-light);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    margin-bottom: 2rem;
}

.table {
    margin-bottom: 0;
}

.table thead th {
    background-color: var(--color-gray-lighter);
    color: #495057;
    font-weight: 600;
    padding: 1rem;
    border-bottom: 2px solid var(--color-gray-light);
    vertical-align: middle;
    position: sticky;
    top: 0;
    z-index: 10;
    text-align: center;
}

.table th i.sort-icon {
    cursor: pointer;
    opacity: 0.5;
    transition: var(--transition-default);
    margin-left: 8px;
}

.table th i.sort-icon:hover {
    opacity: 1;
    color: var(--color-success);
}

.table th .active-sort {
    opacity: 1;
    color: var(--color-success);
}

.table tbody td {
    padding: 1rem;
    vertical-align: middle;
    border-bottom: 1px solid var(--color-gray-light);
    transition: var(--transition-default);
    text-align: center;
}

.table-hover tbody tr:hover {
    background-color: var(--color-success-light);
}

.table tbody tr:last-child td {
    border-bottom: none;
}

/* Estado vacío mejorado */
.empty-state {
    padding: 3rem 1rem;
    text-align: center;
}

.empty-state-icon {
    font-size: 3.5rem;
    color: var(--color-success);
    opacity: 0.7;
    margin-bottom: 1.5rem;
}

.empty-state-title {
    font-size: 1.25rem;
    color: #343a40;
    margin-bottom: 0.5rem;
}

.empty-state-message {
    color: var(--color-gray);
    margin-bottom: 1.5rem;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
}

/* Carga masiva mejorada */
.bulk-upload-card {
    background-color: var(--color-gray-lighter);
    border-radius: var(--border-radius-sm);
    box-shadow: var(--shadow-sm);
    height: 100%;
    padding: 1.25rem;
    transition: var(--transition-default);
}

.bulk-upload-card:hover {
    box-shadow: var(--shadow);
    transform: translateY(-2px);
}

.bulk-upload-title {
    font-size: 1rem;
    font-weight: 500;
    color: #343a40;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
}

.bulk-upload-title i {
    margin-right: 0.5rem;
    color: var(--color-success);
}

.upload-input-group {
    position: relative;
    margin-bottom: 0.75rem;
}

.file-input-container {
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    margin-bottom: 0.75rem;
}

.file-input-label {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 0.6rem 1rem;
    color: #495057;
    background-color: white;
    border: 1px solid var(--color-gray-light);
    border-radius: 50px;
    cursor: pointer;
    transition: var(--transition-default);
    font-size: 0.9rem;
}

.file-input-label:hover {
    background-color: var(--color-success-lighter);
    border-color: var(--color-success);
}

.file-input-label i {
    margin-right: 0.5rem;
}

.file-input {
    position: absolute;
    left: 0;
    top: 0;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

.file-name {
    margin-left: 0.5rem;
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.upload-btn {
    margin-bottom: 0.75rem;
}

.form-hint {
    font-size: 0.8rem;
    color: var(--color-gray);
    margin-top: 0.25rem;
    margin-bottom: 0.75rem;
}

/* Botones de acción en la tabla */
.action-buttons {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
}

.action-btn {
    width: 36px;
    height: 36px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: var(--transition-default);
    background-color: white;
}

.action-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 3px 5px rgba(0,0,0,0.1);
}

.action-btn.edit-btn {
    color: var(--color-success);
    border: 1px solid var(--color-success);
}

.action-btn.edit-btn:hover {
    background-color: var(--color-success);
    color: white;
}

.action-btn.delete-btn {
    color: var(--color-danger);
    border: 1px solid var(--color-danger);
}

.action-btn.delete-btn:hover {
    background-color: var(--color-danger);
    color: white;
}

/* Paginación mejorada */
.pagination-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 1.5rem;
}

.pagination-info {
    color: var(--color-gray);
    font-size: 0.9rem;
}

.pagination {
    display: flex;
    padding-left: 0;
    list-style: none;
    margin-bottom: 0;
}

.page-item .page-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    margin: 0 3px;
    padding: 0;
    border-radius: 50%;
    font-size: 0.9rem;
    color: var(--color-success);
    background-color: white;
    border: 1px solid var(--color-gray-light);
    transition: var(--transition-default);
}

.page-item .page-link:hover {
    background-color: var(--color-success-lighter);
    border-color: var(--color-success);
    transform: scale(1.1);
    z-index: 5;
}

.page-item.active .page-link {
    background-color: var(--color-success);
    border-color: var(--color-success);
    color: white;
    box-shadow: 0 0 10px rgba(40, 167, 69, 0.3);
    z-index: 3;
}

.page-item.disabled .page-link {
    color: var(--color-gray);
    background-color: var(--color-gray-lighter);
    border-color: var(--color-gray-light);
    pointer-events: none;
}

/* Badge para información adicional */
.badge {
    padding: 0.4em 0.6em;
    font-size: 0.75em;
    font-weight: 500;
    border-radius: 50px;
}

.badge-success {
    background-color: rgba(40, 167, 69, 0.15);
    color: var(--color-success);
}

/* Animaciones */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.fade-in {
    animation: fadeIn 0.5s ease forwards;
}

.animate-row {
    opacity: 0;
    animation: fadeIn 0.5s ease forwards;
}

/* Animaciones escalonadas para filas */
.animate-row:nth-child(1) { animation-delay: 0.05s; }
.animate-row:nth-child(2) { animation-delay: 0.1s; }
.animate-row:nth-child(3) { animation-delay: 0.15s; }
.animate-row:nth-child(4) { animation-delay: 0.2s; }
.animate-row:nth-child(5) { animation-delay: 0.25s; }
.animate-row:nth-child(6) { animation-delay: 0.3s; }
.animate-row:nth-child(7) { animation-delay: 0.35s; }
.animate-row:nth-child(8) { animation-delay: 0.4s; }
.animate-row:nth-child(9) { animation-delay: 0.45s; }
.animate-row:nth-child(10) { animation-delay: 0.5s; }

/* Mejoras para el botón eliminar todos */
.delete-all-container {
    padding: 0.5rem 0;
    margin-bottom: 1.5rem;
}

.delete-all-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: var(--transition-default);
}

.delete-all-btn:hover {
    transform: translateY(-2px);
}

.delete-all-btn i {
    transition: var(--transition-default);
}

.delete-all-btn:hover i {
    animation: shake 0.5s ease;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-3px) rotate(-2deg); }
    75% { transform: translateX(3px) rotate(2deg); }
}

/* Estilos para destacar la información de contacto */
.email-cell {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.email-cell i {
    color: var(--color-success);
}

.email-link {
    color: #495057;
    text-decoration: none;
    transition: var(--transition-default);
}

.email-link:hover {
    color: var(--color-success);
    text-decoration: underline;
}

.phone-cell {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.phone-cell i {
    color: var(--color-success);
}

/* Personalización para SweetAlert2 */
.swal2-popup {
    border-radius: var(--border-radius) !important;
    padding: 2rem !important;
}

.swal2-title {
    color: #343a40 !important;
    font-size: 1.5rem !important;
    font-weight: 600 !important;
}

.swal2-html-container {
    margin-top: 1.5rem !important;
}

.swal2-styled.swal2-confirm {
    background-color: var(--color-success) !important;
    border-radius: 50px !important;
    padding: 0.75rem 1.5rem !important;
    font-weight: 500 !important;
}

.swal2-styled.swal2-cancel {
    background-color: var(--color-gray) !important;
    border-radius: 50px !important;
    padding: 0.75rem 1.5rem !important;
    font-weight: 500 !important;
}

/* Estilos responsivos */
@media (max-width: 992px) {
    .card-body {
        padding: 1.5rem;
    }
    
    .search-wrapper {
        margin-bottom: 1.5rem;
    }
    
    .custom-search-input {
        padding: 12px 55px 12px 20px;
    }
    
    .table-container {
        margin-bottom: 1.5rem;
    }
    
    .pagination-container {
        flex-direction: column;
        align-items: center;
    }
}

@media (max-width: 768px) {
    .card-body {
        padding: 1rem;
    }
    
    .table thead th, 
    .table tbody td {
        padding: 0.75rem 0.5rem;
    }
    
    .action-btn {
        width: 32px;
        height: 32px;
    }
    
    .page-item .page-link {
        width: 35px;
        height: 35px;
        margin: 0 2px;
    }
    
    .custom-search-input {
        padding: 10px 50px 10px 15px;
    }
    
    .search-btn {
        width: 34px;
        height: 34px;
    }
}

@media (max-width: 576px) {
    .card-header {
        padding: 1rem;
    }
    
    .card-header .btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.875rem;
    }
    
    .card-body {
        padding: 0.75rem;
    }
    
    .table thead th, 
    .table tbody td {
        padding: 0.6rem 0.4rem;
        font-size: 0.875rem;
    }
    
    .action-btn {
        width: 30px;
        height: 30px;
    }
    
    .delete-all-btn {
        width: 100%;
        justify-content: center;
    }
    
    .table-container {
        border-radius: var(--border-radius-sm);
    }
}

/* Estilos para la búsqueda en tiempo real */
#search-status {
    display: none;
    margin-top: 0.5rem;
    padding: 0.75rem;
    border-radius: 8px;
    background-color: var(--color-success-lighter);
    color: var(--color-success);
    font-size: 0.9rem;
    animation: fadeIn 0.3s ease;
}

#search-status.searching {
    background-color: var(--color-gray-lighter);
    color: var(--color-gray);
}

#search-status.error {
    background-color: rgba(220, 53, 69, 0.1);
    color: var(--color-danger);
}

.search-status-icon {
    margin-right: 0.5rem;
}

/* Animación de carga */
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.spin {
    display: inline-block;
    animation: spin 1s linear infinite;
}

/* Resaltado de coincidencias */
mark {
    background-color: rgba(255, 193, 7, 0.3);
    padding: 0.1em 0.2em;
    border-radius: 3px;
    font-weight: 500;
}

/* Indicador de carga para la tabla */
.table-loading {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 255, 255, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    border-radius: var(--border-radius);
}

.table-loading-content {
    background-color: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.table-loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(40, 167, 69, 0.2);
    border-top-color: var(--color-success);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.table-loading-text {
    font-weight: 500;
    color: var(--color-success);
}

/* Atajos de teclado */
.keyboard-shortcut {
    display: inline-flex;
    align-items: center;
    margin-left: 0.5rem;
    color: var(--color-gray);
    font-size: 0.8rem;
}

.key {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 20px;
    height: 20px;
    padding: 0 4px;
    background-color: #f1f1f1;
    border: 1px solid #ddd;
    border-radius: 3px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    margin: 0 2px;
    font-family: monospace;
    font-size: 0.75rem;
    font-weight: 600;
}

/* Tooltip personalizado */
.custom-tooltip {
    position: relative;
    display: inline-block;
}

.custom-tooltip .tooltip-text {
    visibility: hidden;
    width: 200px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s;
}

.custom-tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}
</style>
{% endblock extra_css %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="card shadow rounded-4">
        <!-- Encabezado -->
        <div class="card-header bg-success text-white py-4 rounded-top-4">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                <h1 class="mb-0 fs-4">
                    <i class="bi bi-person-badge me-2" aria-hidden="true"></i>Instructores
                </h1>
                <div class="d-flex gap-2">
                    <a href="{% url 'instructor_create' %}" class="btn btn-light rounded-pill border transition" aria-label="Crear nuevo instructor">
                        <i class="bi bi-plus-circle me-2 text-success" aria-hidden="true"></i><span class="text-dark">Nuevo Instructor</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="card-body p-4 p-md-5">
            <!-- Fila de búsqueda y carga masiva -->
            <div class="row mb-4">
                <!-- Buscador -->
                <div class="col-md-7">
                    <div class="search-wrapper">
                        <input type="text" 
                               id="live-search-input"
                               class="custom-search-input" 
                               placeholder="Buscar por nombre, apellido, correo, celular o cédula..."
                               value="{{ search|default:'' }}"
                               aria-label="Buscar instructores"
                               autocomplete="off"
                               autocorrect="off"
                               autocapitalize="off"
                               spellcheck="false">
                        <button type="button" id="clear-search-btn" class="clear-btn" aria-label="Limpiar búsqueda">
                            <i class="bi bi-x-lg" aria-hidden="true"></i>
                        </button>
                        <button type="button" id="search-btn" class="search-btn" aria-label="Buscar">
                            <i class="bi bi-search" aria-hidden="true"></i>
                        </button>
                        <div class="keyboard-shortcut">
                        </div>
                    </div>
                    <div id="search-status">
                        <i class="bi bi-info-circle search-status-icon"></i>
                        <span id="search-status-text"></span>
                    </div>
                </div>

                <!-- Carga Masiva -->
                <div class="col-md-5">
                    <div class="bulk-upload-card">
                        <h6 class="bulk-upload-title">
                            <i class="bi bi-cloud-upload" aria-hidden="true"></i>
                            Carga Masiva de Instructores
                        </h6>
                        
                        <form method="post" enctype="multipart/form-data" action="{% url 'upload_instructors_excel' %}" class="d-flex flex-column gap-2">
                            {% csrf_token %}
                            
                            <div class="file-input-container">
                                <label for="file-upload" class="file-input-label">
                                    <i class="bi bi-file-earmark-excel" aria-hidden="true"></i>
                                    <span id="file-name">Seleccionar archivo Excel</span>
                                </label>
                                <input id="file-upload" type="file" name="file" class="file-input" accept=".xlsx,.xls" required aria-required="true">
                            </div>
                            
                            <button type="submit" class="btn btn-light rounded-pill border w-100 upload-btn" aria-label="Cargar archivo Excel">
                                <i class="bi bi-upload me-2 text-success" aria-hidden="true"></i><span class="text-dark">Cargar Instructores</span>
                            </button>
                            
                            <div class="form-hint">
                                <i class="bi bi-info-circle me-1" aria-hidden="true"></i>
                                Formatos soportados: .xlsx, .xls - 
                                <a href="{% url 'download_instructor_template' %}" class="text-success fw-medium" aria-label="Descargar plantilla Excel para instructores">
                                    Descargar Plantilla
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Fila de controles y eliminar todos -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="delete-all-container d-flex justify-content-between align-items-center">
                        <div>
                            {% if paginator.count %}
                                <div class="badge badge-success">
                                    <span id="total-count">{{ paginator.count }}</span> instructores en total
                                </div>
                            {% endif %}
                        </div>
                        
                        <button id="deleteAllBtn" class="btn btn-outline-danger delete-all-btn" aria-label="Eliminar todos los instructores">
                            <i class="bi bi-trash-fill" aria-hidden="true"></i>
                            Eliminar Todos los Instructores
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tabla de Instructores -->
            <div class="table-container">
                <!-- Indicador de carga para la tabla -->
                <div id="table-loading" class="table-loading" style="display: none;">
                    <div class="table-loading-content">
                        <div class="table-loading-spinner"></div>
                        <div class="table-loading-text">Cargando resultados...</div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-hover align-middle" aria-label="Listado de instructores">
                        <thead>
                            <tr>
                                <th scope="col" class="text-center">
                                    <div class="d-flex align-items-center justify-content-center">
                                        <span>Nombres</span>
                                        <i class="bi bi-arrow-down-up sort-icon" data-column="0" aria-label="Ordenar por nombres" tabindex="0" role="button"></i>
                                    </div>
                                </th>
                                <th scope="col" class="text-center">
                                    <div class="d-flex align-items-center justify-content-center">
                                        <span>Apellidos</span>
                                        <i class="bi bi-arrow-down-up sort-icon" data-column="1" aria-label="Ordenar por apellidos" tabindex="0" role="button"></i>
                                    </div>
                                </th>
                                <th scope="col" class="text-center">
                                    <div class="d-flex align-items-center justify-content-center">
                                        <span>Correo Institucional</span>
                                        <i class="bi bi-arrow-down-up sort-icon" data-column="2" aria-label="Ordenar por correo" tabindex="0" role="button"></i>
                                    </div>
                                </th>
                                <th scope="col" class="text-center">Celular</th>
                                <th scope="col" class="text-center">
                                    <div class="d-flex align-items-center justify-content-center">
                                        <span>Cédula</span>
                                        <i class="bi bi-arrow-down-up sort-icon" data-column="4" aria-label="Ordenar por cédula" tabindex="0" role="button"></i>
                                    </div>
                                </th>
                                <th scope="col" class="text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="instructors-table-body">
                            {% for instructor in page_obj %}
                            <tr class="animate-row" data-id="{{ instructor.id }}">
                                <td class="text-center">{{ instructor.nombres }}</td>
                                <td class="text-center">{{ instructor.apellidos }}</td>
                                <td class="text-center">
                                    <div class="email-cell justify-content-center">
                                        <i class="bi bi-envelope" aria-hidden="true"></i>
                                        <a href="mailto:{{ instructor.correo_institucional }}" class="email-link">
                                            {{ instructor.correo_institucional }}
                                        </a>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="phone-cell justify-content-center">
                                        <i class="bi bi-telephone" aria-hidden="true"></i>
                                        {{ instructor.numero_celular }}
                                    </div>
                                </td>
                                <td class="text-center">{{ instructor.numero_cedula }}</td>
                                <td class="text-center">
                                    <div class="action-buttons">
                                        <a href="{% url 'instructor_edit' instructor.id %}" 
                                           class="action-btn edit-btn" 
                                           aria-label="Editar {{ instructor.nombres }} {{ instructor.apellidos }}"
                                           data-bs-toggle="tooltip" 
                                           data-bs-title="Editar">
                                            <i class="bi bi-pencil-square" aria-hidden="true"></i>
                                        </a>
                                        <button type="button"
                                                class="action-btn delete-btn delete-instructor" 
                                                data-id="{{ instructor.id }}"
                                                data-nombre="{{ instructor.nombres }} {{ instructor.apellidos }}"
                                                aria-label="Eliminar {{ instructor.nombres }} {{ instructor.apellidos }}"
                                                data-bs-toggle="tooltip" 
                                                data-bs-title="Eliminar">
                                            <i class="bi bi-trash" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center">
                                    <div class="empty-state">
                                        <div class="empty-state-icon">
                                            <i class="bi bi-people" aria-hidden="true"></i>
                                        </div>
                                        <h3 class="empty-state-title">No hay instructores registrados</h3>
                                        <p class="empty-state-message">
                                            {% if search %}
                                                No se encontraron instructores que coincidan con tu búsqueda "{{ search }}".
                                                <a href="{% url 'instructor_list' %}" class="text-success">Ver todos los instructores</a>
                                            {% else %}
                                                Puedes crear un nuevo instructor o cargar varios instructores desde un archivo Excel.
                                            {% endif %}
                                        </p>
                                        {% if not search %}
                                            <a href="{% url 'instructor_create' %}" class="btn btn-light rounded-pill border transition">
                                                <i class="bi bi-plus-circle me-2 text-success" aria-hidden="true"></i><span class="text-dark">Nuevo Instructor</span>
                                            </a>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Paginación -->
            {% if page_obj.has_other_pages %}
            <div class="pagination-container">
                <div class="pagination-info">
                    Mostrando <span id="start-index">{{ page_obj.start_index }}</span> a <span id="end-index">{{ page_obj.end_index }}</span> de <span id="total-items">{{ paginator.count }}</span> instructores
                    {% if search %} para la búsqueda "<span id="search-term">{{ search }}</span>"{% endif %}
                </div>
                <nav aria-label="Paginación de instructores">
                    <ul class="pagination" id="pagination">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1{% if search %}&search={{ search }}{% endif %}" aria-label="Primera página">
                                    <i class="bi bi-chevron-double-left" aria-hidden="true"></i>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}" aria-label="Página anterior">
                                    <i class="bi bi-chevron-left" aria-hidden="true"></i>
                                </a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link" aria-label="Primera página">
                                    <i class="bi bi-chevron-double-left" aria-hidden="true"></i>
                                </span>
                            </li>
                            <li class="page-item disabled">
                                <span class="page-link" aria-label="Página anterior">
                                    <i class="bi bi-chevron-left" aria-hidden="true"></i>
                                </span>
                            </li>
                        {% endif %}

                        <!-- Páginas numeradas -->
                        {% for num in page_obj.paginator.page_range %}
                            {% if page_obj.number == num %}
                                <li class="page-item active">
                                    <span class="page-link" aria-current="page">{{ num }}</span>
                                </li>
                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ num }}{% if search %}&search={{ search }}{% endif %}">{{ num }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}" aria-label="Página siguiente">
                                    <i class="bi bi-chevron-right" aria-hidden="true"></i>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search %}&search={{ search }}{% endif %}" aria-label="Última página">
                                    <i class="bi bi-chevron-double-right" aria-hidden="true"></i>
                                </a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <span class="page-link" aria-label="Página siguiente">
                                    <i class="bi bi-chevron-right" aria-hidden="true"></i>
                                </span>
                            </li>
                            <li class="page-item disabled">
                                <span class="page-link" aria-label="Última página">
                                    <i class="bi bi-chevron-double-right" aria-hidden="true"></i>
                                </span>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock content %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar tooltips
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    const tooltipList = [];
    tooltipTriggerList.forEach(function(tooltipTriggerEl) {
        tooltipList.push(new bootstrap.Tooltip(tooltipTriggerEl, {
            delay: { show: 300, hide: 100 },
            placement: 'top'
        }));
    });

    // Mostrar nombre del archivo seleccionado
    const fileInput = document.getElementById('file-upload');
    const fileName = document.getElementById('file-name');
    
    if (fileInput) {
        fileInput.addEventListener('change', function() {
            fileName.textContent = this.files[0] ? this.files[0].name : 'Seleccionar archivo Excel';
        });
    }

    // Manejador para ordenamiento de columnas
    const sortIcons = document.querySelectorAll('.sort-icon');
    sortIcons.forEach(function(icon) {
        icon.addEventListener('click', function() {
            const column = parseInt(this.getAttribute('data-column'));
            const table = this.closest('table');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr:not([colspan])'));
            
            // Cambiar estado de ordenamiento
            if (this.classList.contains('bi-arrow-down')) {
                this.classList.replace('bi-arrow-down', 'bi-arrow-up');
                this.setAttribute('data-order', 'asc');
            } else if (this.classList.contains('bi-arrow-up')) {
                this.classList.replace('bi-arrow-up', 'bi-arrow-down-up');
                this.setAttribute('data-order', 'none');
            } else {
                this.classList.replace('bi-arrow-down-up', 'bi-arrow-down');
                this.setAttribute('data-order', 'desc');
            }
            
            // Restablecer otros iconos
            sortIcons.forEach(function(otherIcon) {
                if (otherIcon !== icon) {
                    otherIcon.classList.replace('bi-arrow-down', 'bi-arrow-down-up');
                    otherIcon.classList.replace('bi-arrow-up', 'bi-arrow-down-up');
                    otherIcon.removeAttribute('data-order');
                }
            });
            
            // Ordenar filas
            const order = this.getAttribute('data-order');
            if (order && order !== 'none' && rows.length > 0) {
                rows.sort(function(a, b) {
                    const aValue = a.cells[column].textContent.trim();
                    const bValue = b.cells[column].textContent.trim();
                    
                    if (order === 'asc') {
                        return aValue.localeCompare(bValue, 'es', { sensitivity: 'base' });
                    } else {
                        return bValue.localeCompare(aValue, 'es', { sensitivity: 'base' });
                    }
                });
                
                // Animar al reordenar
                rows.forEach(function(row) {
                    row.style.animation = 'none';
                    row.offsetHeight; // Trigger reflow
                    row.style.animation = null;
                    tbody.appendChild(row);
                });
            }
        });
        
        // Soporte para teclado en los íconos de ordenación
        icon.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                this.click();
            }
        });
    });

    // Manejador para botones de eliminación individual
    const deleteButtons = document.querySelectorAll('.delete-instructor');
    deleteButtons.forEach(function(button) {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Ocultar cualquier tooltip
            tooltipList.forEach(function(tooltip) {
                tooltip.hide();
            });
            
            const instructorId = this.getAttribute('data-id');
            const instructorNombre = this.getAttribute('data-nombre');
            
            Swal.fire({
                title: '¿Estás seguro?',
                html: '¿Deseas eliminar al instructor <strong>' + instructorNombre + '</strong>?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#28a745',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar',
                reverseButtons: true,
                showLoaderOnConfirm: true,
                focusConfirm: false,
                allowOutsideClick: function() { return !Swal.isLoading(); },
                preConfirm: function() {
                    return new Promise(function(resolve) {
                        // Mostrar indicador de carga
                        document.body.classList.add('processing');
                        
                        const form = document.createElement('form');
                        form.method = 'POST';
                        form.action = '/instructores/' + instructorId + '/delete/';
                        
                        const csrf = document.createElement('input');
                        csrf.type = 'hidden';
                        csrf.name = 'csrfmiddlewaretoken';
                        csrf.value = document.querySelector('[name=csrfmiddlewaretoken]').value;
                        
                        form.appendChild(csrf);
                        document.body.appendChild(form);
                        form.submit();
                    });
                }
            });
        });
    });

    // Manejador para el botón de eliminar todos
    const deleteAllBtn = document.getElementById('deleteAllBtn');
    if (deleteAllBtn) {
        deleteAllBtn.addEventListener('click', function() {
            Swal.fire({
                title: '¿Eliminar todos los instructores?',
                html: 
                    '<div class="text-start">' +
                    '<p class="mb-2">Esta acción eliminará <strong>todos los instructores</strong> del sistema.</p>' +
                    '<p class="mb-0 text-danger fw-medium">Esta acción no se puede deshacer.</p>' +
                    '</div>',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#28a745',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Sí, eliminar todos',
                cancelButtonText: 'Cancelar',
                reverseButtons: true,
                showLoaderOnConfirm: true,
                focusCancel: true,
                allowOutsideClick: function() { return !Swal.isLoading(); },
                preConfirm: function() {
                    return fetch('{% url "delete_all_instructors" %}', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                            'Content-Type': 'application/json',
                        }
                    })
                    .then(function(response) {
                        if (!response.ok) {
                            throw new Error(response.statusText);
                        }
                        return response.json();
                    })
                    .catch(function(error) {
                        Swal.showValidationMessage('Error: ' + error.message);
                    });
                }
            }).then(function(result) {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: '¡Instructores eliminados!',
                        text: 'Todos los instructores han sido eliminados correctamente.',
                        icon: 'success',
                        confirmButtonColor: '#28a745',
                        showConfirmButton: false,
                        timer: 2000
                    }).then(function() {
                        window.location.reload();
                    });
                }
            });
        });
    }

    // ===== BÚSQUEDA EN TIEMPO REAL =====
    
    // Configuración
    const config = {
        useAjaxSearch: true, // Cambiar a false para usar búsqueda del lado del cliente
        minChars: 2, // Mínimo de caracteres para iniciar la búsqueda
        debounceTime: 300, // Tiempo de espera entre pulsaciones de teclas (ms)
        highlightResults: true, // Resaltar coincidencias en los resultados
        searchEndpoint: '{% url "instructor_search" %}', // URL para búsqueda AJAX
    };
    
    // Elementos DOM
    const searchInput = document.getElementById('live-search-input');
    const clearButton = document.getElementById('clear-search-btn');
    const searchButton = document.getElementById('search-btn');
    const searchStatus = document.getElementById('search-status');
    const searchStatusText = document.getElementById('search-status-text');
    const tableBody = document.getElementById('instructors-table-body');
    const tableLoading = document.getElementById('table-loading');
    
    // Almacenar todas las filas originales para búsqueda del lado del cliente
    let allRows = [];
    if (!config.useAjaxSearch) {
        allRows = Array.from(tableBody.querySelectorAll('tr:not([id="no-results-row"])'));
    }
    
    // Función para debounce (evitar múltiples llamadas rápidas)
    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    }
    
    // Función para resaltar texto coincidente
    function highlightText(text, query) {
        if (!config.highlightResults || !query) return text;
        
        const regex = new RegExp(`(${query.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    }
    
    // Función para mostrar mensaje de "no hay resultados"
    function showNoResults(query) {
        // Eliminar mensaje existente si hay
        const existingMessage = document.getElementById('no-results-row');
        if (existingMessage) existingMessage.remove();
        
        // Crear y mostrar nuevo mensaje
        const noResults = document.createElement('tr');
        noResults.id = 'no-results-row';
        noResults.innerHTML = `
            <td colspan="6" class="text-center">
                <div class="empty-state" style="padding: 2rem 1rem;">
                    <div class="empty-state-icon" style="font-size: 2rem;">
                        <i class="bi bi-search" aria-hidden="true"></i>
                    </div>
                    <h3 class="empty-state-title">No se encontraron resultados</h3>
                    <p class="empty-state-message">
                        No hay instructores que coincidan con "${query}"
                    </p>
                </div>
            </td>
        `;
        tableBody.appendChild(noResults);
    }
    
    // Función para actualizar el estado de la búsqueda
    function updateSearchStatus(message, isSearching = false, isError = false) {
        if (message) {
            searchStatusText.innerHTML = message;
            searchStatus.style.display = 'block';
            
            // Actualizar clases según el estado
            searchStatus.classList.remove('searching', 'error');
            
            if (isSearching) {
                searchStatus.classList.add('searching');
                searchStatusText.innerHTML = `<i class="bi bi-arrow-repeat spin me-1"></i> ${message}`;
            } else if (isError) {
                searchStatus.classList.add('error');
                searchStatusText.innerHTML = `<i class="bi bi-exclamation-triangle me-1"></i> ${message}`;
            } else {
                searchStatusText.innerHTML = `<i class="bi bi-info-circle me-1"></i> ${message}`;
            }
        } else {
            searchStatus.style.display = 'none';
        }
    }
    
    // Función para búsqueda del lado del cliente
    function clientSideSearch(query) {
        query = query.toLowerCase().trim();
        
        // Ocultar todas las filas primero
        let visibleCount = 0;
        
        allRows.forEach(row => {
            let found = false;
            
            // Buscar en todas las celdas excepto la última (acciones)
            const cells = row.querySelectorAll('td:not(:last-child)');
            cells.forEach(cell => {
                const text = cell.textContent.toLowerCase();
                if (text.includes(query)) {
                    found = true;
                    
                    // Resaltar coincidencias si está habilitado
                    if (config.highlightResults && query.length > 0) {
                        const originalHTML = cell.innerHTML;
                        // Solo resaltar texto, no HTML
                        const textNodes = Array.from(cell.childNodes).filter(node => 
                            node.nodeType === Node.TEXT_NODE || 
                            (node.nodeType === Node.ELEMENT_NODE && !node.querySelector('i'))
                        );
                        
                        textNodes.forEach(node => {
                            if (node.nodeType === Node.TEXT_NODE) {
                                const newText = highlightText(node.textContent, query);
                                if (newText !== node.textContent) {
                                    const span = document.createElement('span');
                                    span.innerHTML = newText;
                                    node.parentNode.replaceChild(span, node);
                                }
                            } else if (node.nodeType === Node.ELEMENT_NODE) {
                                // Para elementos como enlaces, etc.
                                node.innerHTML = highlightText(node.innerHTML, query);
                            }
                        });
                    }
                }
            });
            
            // Mostrar u ocultar la fila según el resultado
            if (found || query === '') {
                row.style.display = '';
                visibleCount++;
                
                // Añadir clase para animación
                row.classList.add('animate-row');
                row.style.animationDelay = (visibleCount * 0.05) + 's';
            } else {
                row.style.display = 'none';
                row.classList.remove('animate-row');
            }
        });
        
        // Mostrar mensaje si no hay resultados
        if (visibleCount === 0 && query !== '') {
            showNoResults(query);
            updateSearchStatus(`No se encontraron resultados para "${query}"`);
        } else if (query !== '') {
            updateSearchStatus(`Se encontraron ${visibleCount} resultados para "${query}"`);
        } else {
            updateSearchStatus('');
        }
        
        return visibleCount;
    }
    
    // Función para búsqueda AJAX del lado del servidor
    async function serverSideSearch(query) {
        try {
            // Mostrar indicador de carga
            tableLoading.style.display = 'flex';
            updateSearchStatus('Buscando...', true);
            
            // Realizar petición AJAX
            const response = await fetch(`${config.searchEndpoint}?q=${encodeURIComponent(query)}`, {
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                }
            });
            
            if (!response.ok) {
                throw new Error(`Error ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            
            // Limpiar tabla actual
            const existingRows = tableBody.querySelectorAll('tr');
            existingRows.forEach(row => row.remove());
            
            // Mostrar resultados o mensaje de no resultados
            if (data.results && data.results.length > 0) {
                // Crear filas para cada resultado
                data.results.forEach((instructor, index) => {
                    const row = document.createElement('tr');
                    row.className = 'animate-row';
                    row.dataset.id = instructor.id;
                    row.style.animationDelay = (index * 0.05) + 's';
                    
                    // Crear celdas con datos del instructor
                                       // Crear celdas con datos del instructor
                                       row.innerHTML = `
                                       <td class="text-center">${highlightText(instructor.nombres, query)}</td>
                                       <td class="text-center">${highlightText(instructor.apellidos, query)}</td>
                                       <td class="text-center">
                                           <div class="email-cell justify-content-center">
                                               <i class="bi bi-envelope" aria-hidden="true"></i>
                                               <a href="mailto:${instructor.correo_institucional}" class="email-link">
                                                   ${highlightText(instructor.correo_institucional, query)}
                                               </a>
                                           </div>
                                       </td>
                                       <td class="text-center">
                                           <div class="phone-cell justify-content-center">
                                               <i class="bi bi-telephone" aria-hidden="true"></i>
                                               ${highlightText(instructor.numero_celular, query)}
                                           </div>
                                       </td>
                                       <td class="text-center">${highlightText(instructor.numero_cedula, query)}</td>
                                       <td class="text-center">
                                           <div class="action-buttons">
                                               <a href="/instructores/${instructor.id}/edit/" 
                                                  class="action-btn edit-btn" 
                                                  aria-label="Editar ${instructor.nombres} ${instructor.apellidos}"
                                                  data-bs-toggle="tooltip" 
                                                  data-bs-title="Editar">
                                                   <i class="bi bi-pencil-square" aria-hidden="true"></i>
                                               </a>
                                               <button type="button"
                                                       class="action-btn delete-btn delete-instructor" 
                                                       data-id="${instructor.id}"
                                                       data-nombre="${instructor.nombres} ${instructor.apellidos}"
                                                       aria-label="Eliminar ${instructor.nombres} ${instructor.apellidos}"
                                                       data-bs-toggle="tooltip" 
                                                       data-bs-title="Eliminar">
                                                   <i class="bi bi-trash" aria-hidden="true"></i>
                                               </button>
                                           </div>
                                       </td>
                                   `;
                    
                    tableBody.appendChild(row);
                });
                
                // Reinicializar tooltips para los nuevos botones
                const newTooltips = tableBody.querySelectorAll('[data-bs-toggle="tooltip"]');
                newTooltips.forEach(el => {
                    new bootstrap.Tooltip(el, {
                        delay: { show: 300, hide: 100 },
                        placement: 'top'
                    });
                });
                
                // Reinicializar manejadores de eventos para botones de eliminar
                const newDeleteButtons = tableBody.querySelectorAll('.delete-instructor');
                newDeleteButtons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        const instructorId = this.getAttribute('data-id');
                        const instructorNombre = this.getAttribute('data-nombre');
                        
                        Swal.fire({
                            title: '¿Estás seguro?',
                            html: '¿Deseas eliminar al instructor <strong>' + instructorNombre + '</strong>?',
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonColor: '#28a745',
                            cancelButtonColor: '#6c757d',
                            confirmButtonText: 'Sí, eliminar',
                            cancelButtonText: 'Cancelar',
                            reverseButtons: true,
                            showLoaderOnConfirm: true,
                            focusConfirm: false,
                            allowOutsideClick: function() { return !Swal.isLoading(); },
                            preConfirm: function() {
                                return new Promise(function(resolve) {
                                    document.body.classList.add('processing');
                                    
                                    const form = document.createElement('form');
                                    form.method = 'POST';
                                    form.action = '/instructores/' + instructorId + '/delete/';
                                    
                                    const csrf = document.createElement('input');
                                    csrf.type = 'hidden';
                                    csrf.name = 'csrfmiddlewaretoken';
                                    csrf.value = document.querySelector('[name=csrfmiddlewaretoken]').value;
                                    
                                    form.appendChild(csrf);
                                    document.body.appendChild(form);
                                    form.submit();
                                });
                            }
                        });
                    });
                });
                
                // Actualizar información de paginación
                updatePaginationInfo(data.results.length, query);
                
                // Actualizar mensaje de estado
                updateSearchStatus(`Se encontraron ${data.results.length} resultados para "${query}"`);
            } else {
                showNoResults(query);
                updateSearchStatus(`No se encontraron resultados para "${query}"`);
                updatePaginationInfo(0, query);
            }
            
            // Ocultar indicador de carga
            tableLoading.style.display = 'none';
            
            return data.results ? data.results.length : 0;
            
        } catch (error) {
            console.error('Error en la búsqueda:', error);
            updateSearchStatus(`Error al buscar: ${error.message}`, false, true);
            tableLoading.style.display = 'none';
            return 0;
        }
    }
    
    // Función para actualizar la información de paginación
    function updatePaginationInfo(count, query) {
        const totalCountElement = document.getElementById('total-count');
        const totalItemsElement = document.getElementById('total-items');
        const startIndexElement = document.getElementById('start-index');
        const endIndexElement = document.getElementById('end-index');
        const searchTermElement = document.getElementById('search-term');
        const paginationContainer = document.querySelector('.pagination-container');
        
        if (totalCountElement) totalCountElement.textContent = count;
        if (totalItemsElement) totalItemsElement.textContent = count;
        
        if (startIndexElement && endIndexElement) {
            if (count > 0) {
                startIndexElement.textContent = '1';
                endIndexElement.textContent = count;
            } else {
                startIndexElement.textContent = '0';
                endIndexElement.textContent = '0';
            }
        }
        
        if (searchTermElement && query) {
            searchTermElement.textContent = query;
        }
        
        // Mostrar u ocultar la paginación según si hay resultados
        if (paginationContainer) {
            paginationContainer.style.display = count > 0 ? 'flex' : 'none';
        }
        
        // Simplificar la paginación para resultados de búsqueda
        const pagination = document.getElementById('pagination');
        if (pagination && query) {
            // Simplificar a solo "primera página" cuando se está buscando
            pagination.innerHTML = `
                <li class="page-item">
                    <a class="page-link" href="{% url 'instructor_list' %}" aria-label="Volver a la lista completa">
                        <i class="bi bi-arrow-left" aria-hidden="true"></i>
                    </a>
                </li>
            `;
        }
    }
    
       // Función principal de búsqueda
       const performSearch = debounce(async function() {
        const query = searchInput.value.trim();
        
        // Actualizar estado del botón de limpiar
        clearButton.style.display = query ? 'flex' : 'none';
        
        // Si la consulta está vacía, mostrar todos los instructores
        if (query === '') {
            if (config.useAjaxSearch) {
                // Para búsqueda AJAX, redirigir a la página sin filtros
                window.location.href = window.location.pathname;
                return;
            } else {
                // Para búsqueda del lado del cliente, mostrar todas las filas
                allRows.forEach(row => {
                    row.style.display = '';
                    // Eliminar resaltados previos
                    row.querySelectorAll('mark').forEach(mark => {
                        const parent = mark.parentNode;
                        parent.replaceChild(document.createTextNode(mark.textContent), mark);
                        parent.normalize(); // Unir nodos de texto adyacentes
                    });
                });
                
                // Eliminar mensaje de no resultados si existe
                const noResultsRow = document.getElementById('no-results-row');
                if (noResultsRow) noResultsRow.remove();
                
                updateSearchStatus('');
                return;
            }
        }
        
        // Si la consulta es muy corta, no realizar búsqueda
        if (query.length < config.minChars) {
            updateSearchStatus(`Ingrese al menos ${config.minChars} caracteres para buscar`);
            return;
        }
        
        // Ejecutar búsqueda según configuración
        if (config.useAjaxSearch) {
            await serverSideSearch(query);
        } else {
            clientSideSearch(query);
        }
     }, config.debounceTime);
    
    // Eventos para la búsqueda
    if (searchInput) {
        // Evento de entrada de texto
        searchInput.addEventListener('input', performSearch);
        
        // Evento de tecla Escape para limpiar
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                this.value = '';
                clearButton.style.display = 'none';
                performSearch();
            }
        });
        
        // Evento para el botón de búsqueda
        if (searchButton) {
            searchButton.addEventListener('click', function() {
                performSearch();
            });
        }
        
             // Evento para el botón de limpiar
             if (clearButton) {
                clearButton.addEventListener('click', function() {
                    searchInput.value = '';
                    clearButton.style.display = 'none';
                    searchInput.focus();
                    
                    // Redirigir a la página principal sin parámetros de búsqueda
                    if (config.useAjaxSearch) {
                        window.location.href = window.location.pathname;
                    } else {
                        performSearch();
                    }
                });
            }
        
        // Realizar búsqueda inicial si hay texto
        if (searchInput.value.trim()) {
            performSearch();
        }
    }
    
    // Atajos de teclado
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + K para enfocar el campo de búsqueda
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            if (searchInput) searchInput.focus();
        }
    });

    // Animación de entrada para las filas
    document.querySelectorAll('.animate-row').forEach(function(row, index) {
        row.style.animationDelay = (index * 0.05) + "s";
    });
});
</script>
<script src="{% static 'js/instructor-search.js' %}"></script>
{% endblock scripts %}
